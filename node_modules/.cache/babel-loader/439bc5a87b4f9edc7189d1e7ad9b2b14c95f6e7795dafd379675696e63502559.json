{"ast":null,"code":"import{useState,useEffect,useContext,createContext}from'react';import{useAuth}from'./useAuth';import{database}from'../config/supabase';import{jsx as _jsx}from\"react/jsx-runtime\";const LicenseContext=/*#__PURE__*/createContext({});export const useLicense=()=>{const context=useContext(LicenseContext);if(!context){throw new Error('useLicense debe ser usado dentro de un LicenseProvider');}return context;};export const LicenseProvider=_ref=>{let{children}=_ref;const{user}=useAuth();const[license,setLicense]=useState(null);const[loading,setLoading]=useState(true);// Cargar información de licencia del usuario\nconst loadUserLicense=async()=>{if(!(user!==null&&user!==void 0&&user.email)){setLoading(false);return;}try{setLoading(true);const result=await database.getUserLicense(user.email);if(result.success){setLicense(result.data);}else{// Si no hay licencia, crear una gratuita por defecto\nconst defaultLicense={license_type:'free',license_expires_at:new Date(Date.now()+30*24*60*60*1000).toISOString(),// 30 días\nmax_ingredients:50,max_suppliers:10,is_admin:false};setLicense(defaultLicense);}}catch(error){console.error('Error al cargar licencia:',error);// Licencia gratuita por defecto en caso de error\nconst defaultLicense={license_type:'free',license_expires_at:new Date(Date.now()+30*24*60*60*1000).toISOString(),max_ingredients:50,max_suppliers:10,is_admin:false};setLicense(defaultLicense);}finally{setLoading(false);}};useEffect(()=>{loadUserLicense();},[user]);// Verificar si el usuario es administrador\nconst isAdmin=()=>{return(license===null||license===void 0?void 0:license.is_admin)===true;};// Verificar si la licencia está activa\nconst isLicenseActive=()=>{if(!(license!==null&&license!==void 0&&license.license_expires_at))return false;return new Date(license.license_expires_at)>new Date();};// Verificar si tiene acceso a una funcionalidad específica\nconst checkFeatureAccess=feature=>{if(!license)return false;if(isAdmin())return true;// Los administradores tienen acceso a todo\nif(!isLicenseActive())return false;// Licencia expirada\nconst featureLimits={'inventory':license.max_ingredients>0,'suppliers':license.max_suppliers>0,'reports':license.license_type==='premium','advanced_analytics':license.license_type==='premium','export_data':license.license_type==='premium'};return featureLimits[feature]||false;};// Obtener límites actuales\nconst getLimits=()=>{if(!license)return{ingredients:0,suppliers:0};return{ingredients:license.max_ingredients,suppliers:license.max_suppliers};};// Verificar si puede agregar más elementos\nconst canAddMore=(type,currentCount)=>{if(!license)return false;if(isAdmin())return true;if(!isLicenseActive())return false;const limits=getLimits();return currentCount<limits[type];};// Obtener información de la licencia para mostrar al usuario\nconst getLicenseInfo=()=>{if(!license)return null;return{type:license.license_type,expiresAt:license.license_expires_at,isActive:isLicenseActive(),isAdmin:isAdmin(),limits:getLimits(),daysRemaining:license.license_expires_at?Math.ceil((new Date(license.license_expires_at)-new Date())/(1000*60*60*24)):0};};// Obtener opciones de upgrade\nconst getUpgradeOptions=()=>{if(isAdmin())return[];return[{id:'premium',name:'Premium',price:29.99,period:'month',features:['Sin límites de ingredientes','Sin límites de proveedores','Reportes avanzados','Análisis de datos','Exportación de datos','Soporte prioritario'],current:(license===null||license===void 0?void 0:license.license_type)==='premium'}];};// Actualizar licencia (solo para administradores)\nconst updateUserLicense=async(userEmail,licenseData)=>{if(!isAdmin()){throw new Error('Solo los administradores pueden actualizar licencias');}try{const result=await database.updateUserLicense(userEmail,licenseData);if(result.success){// Si es el usuario actual, recargar su licencia\nif(userEmail===(user===null||user===void 0?void 0:user.email)){await loadUserLicense();}return result;}throw new Error(result.error);}catch(error){console.error('Error al actualizar licencia:',error);throw error;}};// Obtener todos los usuarios para administración\nconst getAllUsers=async()=>{if(!isAdmin()){throw new Error('Solo los administradores pueden ver todos los usuarios');}try{const result=await database.getAllUsers();return result;}catch(error){console.error('Error al obtener usuarios:',error);throw error;}};const value={license,loading,isAdmin,isLicenseActive,checkFeatureAccess,getLimits,canAddMore,getLicenseInfo,getUpgradeOptions,updateUserLicense,getAllUsers,loadUserLicense};return/*#__PURE__*/_jsx(LicenseContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["useState","useEffect","useContext","createContext","useAuth","database","jsx","_jsx","LicenseContext","useLicense","context","Error","LicenseProvider","_ref","children","user","license","setLicense","loading","setLoading","loadUserLicense","email","result","getUserLicense","success","data","defaultLicense","license_type","license_expires_at","Date","now","toISOString","max_ingredients","max_suppliers","is_admin","error","console","isAdmin","isLicenseActive","checkFeatureAccess","feature","featureLimits","getLimits","ingredients","suppliers","canAddMore","type","currentCount","limits","getLicenseInfo","expiresAt","isActive","daysRemaining","Math","ceil","getUpgradeOptions","id","name","price","period","features","current","updateUserLicense","userEmail","licenseData","getAllUsers","value","Provider"],"sources":["C:/xampp/htdocs/GestorOficial/src/hooks/useLicense.js"],"sourcesContent":["import { useState, useEffect, useContext, createContext } from 'react'\r\nimport { useAuth } from './useAuth'\r\nimport { database } from '../config/supabase'\r\n\r\nconst LicenseContext = createContext({})\r\n\r\nexport const useLicense = () => {\r\n  const context = useContext(LicenseContext)\r\n  if (!context) {\r\n    throw new Error('useLicense debe ser usado dentro de un LicenseProvider')\r\n  }\r\n  return context\r\n}\r\n\r\nexport const LicenseProvider = ({ children }) => {\r\n  const { user } = useAuth()\r\n  const [license, setLicense] = useState(null)\r\n  const [loading, setLoading] = useState(true)\r\n\r\n  // Cargar información de licencia del usuario\r\n  const loadUserLicense = async () => {\r\n    if (!user?.email) {\r\n      setLoading(false)\r\n      return\r\n    }\r\n\r\n    try {\r\n      setLoading(true)\r\n      const result = await database.getUserLicense(user.email)\r\n      if (result.success) {\r\n        setLicense(result.data)\r\n      } else {\r\n        // Si no hay licencia, crear una gratuita por defecto\r\n        const defaultLicense = {\r\n          license_type: 'free',\r\n          license_expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(), // 30 días\r\n          max_ingredients: 50,\r\n          max_suppliers: 10,\r\n          is_admin: false\r\n        }\r\n        setLicense(defaultLicense)\r\n      }\r\n    } catch (error) {\r\n      console.error('Error al cargar licencia:', error)\r\n      // Licencia gratuita por defecto en caso de error\r\n      const defaultLicense = {\r\n        license_type: 'free',\r\n        license_expires_at: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),\r\n        max_ingredients: 50,\r\n        max_suppliers: 10,\r\n        is_admin: false\r\n      }\r\n      setLicense(defaultLicense)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadUserLicense()\r\n  }, [user])\r\n\r\n  // Verificar si el usuario es administrador\r\n  const isAdmin = () => {\r\n    return license?.is_admin === true\r\n  }\r\n\r\n  // Verificar si la licencia está activa\r\n  const isLicenseActive = () => {\r\n    if (!license?.license_expires_at) return false\r\n    return new Date(license.license_expires_at) > new Date()\r\n  }\r\n\r\n  // Verificar si tiene acceso a una funcionalidad específica\r\n  const checkFeatureAccess = (feature) => {\r\n    if (!license) return false\r\n    if (isAdmin()) return true // Los administradores tienen acceso a todo\r\n    if (!isLicenseActive()) return false // Licencia expirada\r\n\r\n    const featureLimits = {\r\n      'inventory': license.max_ingredients > 0,\r\n      'suppliers': license.max_suppliers > 0,\r\n      'reports': license.license_type === 'premium',\r\n      'advanced_analytics': license.license_type === 'premium',\r\n      'export_data': license.license_type === 'premium'\r\n    }\r\n\r\n    return featureLimits[feature] || false\r\n  }\r\n\r\n  // Obtener límites actuales\r\n  const getLimits = () => {\r\n    if (!license) return { ingredients: 0, suppliers: 0 }\r\n    return {\r\n      ingredients: license.max_ingredients,\r\n      suppliers: license.max_suppliers\r\n    }\r\n  }\r\n\r\n  // Verificar si puede agregar más elementos\r\n  const canAddMore = (type, currentCount) => {\r\n    if (!license) return false\r\n    if (isAdmin()) return true\r\n    if (!isLicenseActive()) return false\r\n\r\n    const limits = getLimits()\r\n    return currentCount < limits[type]\r\n  }\r\n\r\n  // Obtener información de la licencia para mostrar al usuario\r\n  const getLicenseInfo = () => {\r\n    if (!license) return null\r\n\r\n    return {\r\n      type: license.license_type,\r\n      expiresAt: license.license_expires_at,\r\n      isActive: isLicenseActive(),\r\n      isAdmin: isAdmin(),\r\n      limits: getLimits(),\r\n      daysRemaining: license.license_expires_at \r\n        ? Math.ceil((new Date(license.license_expires_at) - new Date()) / (1000 * 60 * 60 * 24))\r\n        : 0\r\n    }\r\n  }\r\n\r\n  // Obtener opciones de upgrade\r\n  const getUpgradeOptions = () => {\r\n    if (isAdmin()) return []\r\n\r\n    return [\r\n      {\r\n        id: 'premium',\r\n        name: 'Premium',\r\n        price: 29.99,\r\n        period: 'month',\r\n        features: [\r\n          'Sin límites de ingredientes',\r\n          'Sin límites de proveedores',\r\n          'Reportes avanzados',\r\n          'Análisis de datos',\r\n          'Exportación de datos',\r\n          'Soporte prioritario'\r\n        ],\r\n        current: license?.license_type === 'premium'\r\n      }\r\n    ]\r\n  }\r\n\r\n  // Actualizar licencia (solo para administradores)\r\n  const updateUserLicense = async (userEmail, licenseData) => {\r\n    if (!isAdmin()) {\r\n      throw new Error('Solo los administradores pueden actualizar licencias')\r\n    }\r\n\r\n    try {\r\n      const result = await database.updateUserLicense(userEmail, licenseData)\r\n      if (result.success) {\r\n        // Si es el usuario actual, recargar su licencia\r\n        if (userEmail === user?.email) {\r\n          await loadUserLicense()\r\n        }\r\n        return result\r\n      }\r\n      throw new Error(result.error)\r\n    } catch (error) {\r\n      console.error('Error al actualizar licencia:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  // Obtener todos los usuarios para administración\r\n  const getAllUsers = async () => {\r\n    if (!isAdmin()) {\r\n      throw new Error('Solo los administradores pueden ver todos los usuarios')\r\n    }\r\n\r\n    try {\r\n      const result = await database.getAllUsers()\r\n      return result\r\n    } catch (error) {\r\n      console.error('Error al obtener usuarios:', error)\r\n      throw error\r\n    }\r\n  }\r\n\r\n  const value = {\r\n    license,\r\n    loading,\r\n    isAdmin,\r\n    isLicenseActive,\r\n    checkFeatureAccess,\r\n    getLimits,\r\n    canAddMore,\r\n    getLicenseInfo,\r\n    getUpgradeOptions,\r\n    updateUserLicense,\r\n    getAllUsers,\r\n    loadUserLicense\r\n  }\r\n\r\n  return (\r\n    <LicenseContext.Provider value={value}>\r\n      {children}\r\n    </LicenseContext.Provider>\r\n  )\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}